# Direct MVI

![version](https://img.shields.io/badge/version-0.0.1-blue.svg)
![language](https://img.shields.io/badge/language-Kotlin-purple.svg)
![platform](https://img.shields.io/badge/platform-Android%20%7C%20Core-green.svg)
![license](https://img.shields.io/badge/license-Apache%202.0-orange.svg)

**Direct** ‚Äî —ç—Ç–æ –ª–µ–≥–∫–æ–≤–µ—Å–Ω–∞—è, –º–æ–¥—É–ª—å–Ω–∞—è –∏ —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è MVI (Model‚ÄìView‚ÄìIntent) –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è Kotlin –∏ Android.

Direct –ø–æ—Å—Ç—Ä–æ–µ–Ω –∫–∞–∫ **–¥–≤–∏–∂–æ–∫ (engine)** –¥–ª—è Unidirectional Data Flow –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π DSL –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å—é, –ø–∞–π–ø–ª–∞–π–Ω–∞–º–∏ `Flow` –∏ –ø–æ–±–æ—á–Ω—ã–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏ ‚Äî **–±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç Android** –≤ —è–¥—Ä–µ.

---

## ‚ú® –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üß† **–ß–∏—Å—Ç–æ–µ —è–¥—Ä–æ (Clean Core)** ‚Äî –ú–æ–¥—É–ª—å `:direct-core` –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ —á–∏—Å—Ç–æ–º Kotlin.
- üîÅ **–°—Ç—Ä–æ–≥–∏–π UDF** ‚Äî –ú–æ–¥–µ–ª—å `Intent ‚Üí State ‚Üí UI`, –≥–¥–µ `State` ‚Äî Single Source of Truth.
- ‚ö° **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å—é** ‚Äî `serial`, `latest`, `dropping`, `concurrent` –∏–∑ –∫–æ—Ä–æ–±–∫–∏.
- üåä **Flow-first –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** ‚Äî –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ `filter`, `debounce`, `distinct`, `catch`.
- üåê **–í–Ω–µ—à–Ω–∏–µ –ø–æ—Ç–æ–∫–∏** ‚Äî –£–¥–æ–±–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ `Flow` –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ —á–µ—Ä–µ–∑ `listen`.
- üîå **Middleware** ‚Äî –ü–ª–∞–≥–∏–Ω—ã –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

–î–æ–±–∞–≤—å—Ç–µ JitPack —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

```kotlin
dependencyResolutionManagement {
    repositories {
        google()
        mavenCentral()
        maven { url = uri("https://jitpack.io") } // <--- –î–æ–±–∞–≤–∏—Ç—å —ç—Ç–æ
    }
}
```

–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –º–æ–¥—É–ª–∏:
```kotlin
dependencies {
    val directVersion = "0.1.0"

    implementation("com.nikol.direct:direct-core:$directVersion")
    implementation("com.nikol.direct:direct-android:$directVersion")
    implementation("com.nikol.direct:direct-compose:$directVersion")
}
```

---

## üß± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
User Action ‚îÄ‚îÄ‚ñ∂ Intent ‚îÄ‚îÄ‚îê
                         ‚ñº
System Event ‚îÄ‚îÄ‚ñ∂ Flow ‚îÄ‚îÄ‚ñ∂ Store ‚îÄ‚îÄ‚ñ∂ State ‚îÄ‚îÄ‚ñ∂ UI
                         ‚îÇ
                         ‚îî‚îÄ‚îÄ‚ñ∂ Effect ‚îÄ‚îÄ‚ñ∂ UI (one-off)
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–æ–Ω—Ç—Ä–∞–∫—Ç

```kotlin
sealed interface HomeIntent : DirectIntent {
    data object Load : HomeIntent
    data class Click(val id: Int) : HomeIntent
}

// data class –Ω–µ –æ–±–∑–∞—Ç–µ–ª–µ–Ω –æ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–∏–º–µ—Ä–∞
data class HomeState(
    val isLoading: Boolean = false, 
    val items: List<String> = emptyList()
) : DirectState

sealed interface HomeEffect : DirectEffect {
    data object Navigate : HomeEffect
}
```

### 2. ViewModel

```kotlin
class HomeViewModel(private val repo: Repository) : DirectViewModel<HomeIntent, HomeState, HomeEffect>() {
    override fun createInitialState() = HomeState()

    override fun handleIntents() = intents {
        // –°—Ç—Ä–∞—Ç–µ–≥–∏—è Latest: –æ—Ç–º–µ–Ω—è–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â—É—é –∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–∏ –Ω–æ–≤–æ–º –∏–Ω—Ç–µ–Ω—Ç–µ
        onLatest<HomeIntent.Load> {
            setState { copy(isLoading = true) }
            val items = repo.load()
            setState { copy(isLoading = false, items = items) }
        }

        // –û–±—ã—á–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
        on<HomeIntent.Click> {
            setEffect { HomeEffect.Navigate }
        }
    }
}
```

---

## ‚ö° –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ DSL

Direct –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –µ–¥–∏–Ω—ã–π API –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∫ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`Intent`), —Ç–∞–∫ –∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–æ–±—ã—Ç–∏–π (`Flow`).

### 1. –û–±—Ä–∞–±–æ—Ç–∫–∞ Intent (`on` / `setup`)

–î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —à–æ—Ä—Ç–∫–∞—Ç—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–π:

```kotlin
on<Click> { ... }       // Serial (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
onLatest<Load> { ... }  // Latest (–æ—Ç–º–µ–Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ)
onSingle<Submit> { ... } // Dropping (–∏–≥–Ω–æ—Ä –Ω–æ–≤—ã—Ö –ø–æ–∫–∞ –∑–∞–Ω—è—Ç)
```

–î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞–π–ø–ª–∞–π–Ω–∞ (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, debounce) –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `setup`:

```kotlin
setup<Search> {
    filter { it.query.length > 2 } // 1. –§–∏–ª—å—Ç—Ä
    debounce(300)                  // 2. –¢–∞–π–º–µ—Ä —Ç–∏—à–∏–Ω—ã
    distinct()                     // 3. –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
    
    catch { e -> ... }             // 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

    latest { intent ->             // 5. –°—Ç—Ä–∞—Ç–µ–≥–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
        // –õ–æ–≥–∏–∫–∞...
    }
}
```

### 2. –í–Ω–µ—à–Ω–∏–µ –ø–æ—Ç–æ–∫–∏ (`listen`)

Store –º–æ–∂–µ—Ç —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –ª—é–±—ã–µ –≤–Ω–µ—à–Ω–∏–µ `Flow` (–ë–î, —Ç–∞–π–º–µ—Ä—ã, —Å–µ—Ç—å). –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ—Ä–∂–∞—Ç—å –≤—Å—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.

> `listen` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ –∂–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏, —á—Ç–æ –∏ Intent.

```kotlin
// –ë–∞–∑–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (Serial)
listen(repository.userFlow) { user ->
    setState { copy(currentUser = user) }
}

// –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å –ø–∞–π–ø–ª–∞–π–Ω–æ–º
listen(networkStatusFlow) {
    debounce(500)
    distinct()
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º Latest —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –ø–æ—Ç–æ–∫–∞
    latest { isOnline ->
        if (isOnline) reloadData()
    }
}
```

---

## üéõ –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏

–≠—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç, —á—Ç–æ –¥–µ–ª–∞—Ç—å —Å **–Ω–æ–≤—ã–º** —Å–æ–±—ã—Ç–∏–µ–º, –µ—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ **–µ—â—ë –∑–∞–Ω—è—Ç** –ø—Ä–µ–¥—ã–¥—É—â–∏–º.

| –°—Ç—Ä–∞—Ç–µ–≥–∏—è                   | DSL                       | –ü–æ–≤–µ–¥–µ–Ω–∏–µ | –°—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
|:----------------------------|:--------------------------| :--- | :--- |
| **Serial**(–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ) | `on`/`serial`             | **–û—á–µ—Ä–µ–¥—å.** –ù–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ –∂–¥—ë—Ç, –ø–æ–∫–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Ç–µ–∫—É—â–µ–µ. –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è (FIFO). | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —Ü–µ–ø–æ—á–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π, –ª–æ–≥–∏–∫–∞, –≥–¥–µ –≤–∞–∂–µ–Ω –ø–æ—Ä—è–¥–æ–∫. |
| **Latest**(–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫)      | `onLatest`/`latest`       | **–ó–∞–º–µ–Ω–∞.** –¢–µ–∫—É—â–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è, –∏ —Å—Ä–∞–∑—É –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è (—Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏). | –ñ–∏–≤–æ–π –ø–æ–∏—Å–∫, –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞. |
| **Dropping**(–ü—Ä–æ–ø—É—Å–∫)       | `onSingle`/`dropping`     | **–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ.** –ï—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–Ω—è—Ç, –Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –ø—Ä–æ—Å—Ç–æ –≤—ã–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è. | –ö–Ω–æ–ø–∫–∏ ¬´–ö—É–ø–∏—Ç—å¬ª, ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å¬ª, –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º-–∫–ª–∏–∫–æ–≤. |
| **Concurrent**(–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ) | `onParallel`/`concurrent` | **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å.** –ö–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ –Ω–æ–≤–æ–π –∫–æ—Ä—É—Ç–∏–Ω–µ. –û–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ. | –ê–Ω–∞–ª–∏—Ç–∏–∫–∞, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏. |

## üîå Middleware

–ü–ª–∞–≥–∏–Ω—ã –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏–ª–∏ Crashlytics. –û–Ω–∏ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫ –∂–∏–∑–Ω–µ–Ω–Ω–æ–º—É —Ü–∏–∫–ª—É Store, –Ω–æ –Ω–µ –º–µ–Ω—è—é—Ç –¥–∞–Ω–Ω—ã–µ.

```kotlin
class LogMiddleware<I : DirectIntent, S : DirectState, E : DirectEffect>(
    private val tag: String
) : DirectMiddleware<I, S, E> {
    override fun onIntent(intent: I) = Log.d(tag, "‚û°Ô∏è Intent: $intent")
    override fun onStateChanged(old: S, new: S) = Log.d(tag, "üîÑ State: $old -> $new")
    override fun onEffect(effect: E) = Log.d(tag, "‚ö° Effect: $effect")
}
```

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**

```kotlin
override fun handleIntents() = intents {
    install(LogMiddleware("HomeVM"))
    // ...
}
```

---

## üß† –§–∏–ª–æ—Å–æ—Ñ–∏—è Direct

1.  **ViewModel –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–≥–∏–∫–∏.** –≠—Ç–æ –ø—Ä–æ—Å—Ç–æ –æ–±–µ—Ä—Ç–∫–∞. –í—Å—è –ª–æ–≥–∏–∫–∞ –≤–Ω—É—Ç—Ä–∏ DSL.
2.  **–ü–æ—Ä—è–¥–æ–∫ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ.** –í –±–ª–æ–∫–∞—Ö `setup` –∏ `listen` –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã (`filter`, `debounce`) –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å—Ç—Ä–æ–≥–æ —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑.
3.  **State ‚Äî —ç—Ç–æ –∏—Å—Ç–∏–Ω–∞.** –ò–∑–º–µ–Ω–µ–Ω–∏—è UI –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –º—É—Ç–∞—Ü–∏—é `State`.

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

```
Apache License 2.0
Copyright 2026 Nikol
```